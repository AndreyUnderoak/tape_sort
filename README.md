# TapeSort
  ## Структура и описание 
  TapeSort представляет из себя консольное приложение для сортировки лент(Tape). Исходные файлы решения находятся в папках src и include.
  Также проект содержит тесты, вспомогательные скрипты для запуска и сборки, а также докер для запуска.

  Далее будет описан алгоритм работы, а также инструкция по запуску на локальной машине, докере.
  
  ## Алгоритм 
  ### Абстракции
  Основными абстракциями являются:
  * tape_sort - скрипт сортировки
  * TapeSorter - сортировщик входных лент(Tape)
  * Tape - лента, использует ReaderEmulator для эмуляции физ. устройства
  * ReaderEmulator - эмулятор физического устройства по средствам файла

  ### Алгоритм работы
  tape_sort принимает путь до двух лент(Tape), входной и выходной. Также в качестве подготовки с помощью ConfigParser производит парсинг configs/config.json, где записаны задержки по записи/чтению элемента с ленты, перемотки ленты, и сдвига ленты на одну позицию.

  Вторым этапом, после инициализации лент(Tape), TapeSorter реализует сортировку и запись значений из входной ленты в выходную. Итеративно считывая часть ленты в буфер(тип set), равный половине оперативной памяти(почему далее). Следующим этапом алгоритм сортирует временную ленту и буфер в выходную ленту. По сути это алгоритм сортировки двух отсортированных масивов, так так на следующей итерации будет производится запись во временную ленту(из выходной и буфера), потом в выходную(из временной и буфера) и так далее.

  Так как запись, чтение и переход в лентах затратные задачи, первый этап(подгрузка буфера) производится в отдельном потоке для n+1 итерации, чтобы на следующей итерации алгоритм сортировки уже имел подгруженный буфер.
  
  ## Запуск приложения
  ### 0. Загрузка репозитория
  ```
  git clone https://gitlab.com/AndreyUnderoak/tape_sort
  cd tape_sort
  chmod +x -R scripts
  ``` 
  
  ### 1. Докер
  Проект имеет докер образ для упрощения восстановления среды сборки.
  #### Этот этап можно пропустить и установить зависимости описанные в docker/Dockerfile, их не много!
  Для запуска докер образа просто введите команду

  ```
  ./scripts/docker_start.sh
  ``` 
  Далее можете переносить, создавать файлы в tape_sort на своей машине и докере, директория полностью примонтирована в контейнер
  ### 2. Компиляция
  #### Важно, если переходите из докера на локальную машину и наоборот удалите папку build
  ```
  ./scripts/build.sh
  ``` 

  ### 3. Запуск
  Можете запустить пример, где в качестве входной ленты выступает files/in.bin:
  ```
  ./scripts/run.sh
  ``` 
  Или ввести напрямую:
  ```
  ./build/tape_sort files/in.bin files/out.bin
  ``` 
  Где files/in.bin можно менять на любой входной бинарный файл

  Где files/out.bin можно менять на любой выходной бинарный файл

  ### 4. Дополнительные функции 
  Для чтения результата(или любой другой) ленты, введите:
  ```
  ./build/tape_reader files/out.bin
  ``` 
  Для записи новой ленты, введите:
  ```
  ./build/tape_recorder files/in.bin
  ``` 
  ### 5. Конфигурация
  Для конфигурации измените configs/config.json:
  ```
  {
    "memory_int": 4,
    "delays": {
        "read_write": 500,
        "go_to": 10,
        "go_end": 1000
    }
  }
  ``` 
  Где:
  * memory_int - колличество оперативной памяти в int
  * read_write - задержки по записи/чтению элемента с ленты в миллисекундах
  * go_to - задержки по сдвига ленты на одну позицию в миллисекундах
  * go_end - задержки по перемотки ленты в миллисекундах

  ### 5. Запуск тестов
  Для запуска тестов, введите:
  ```
  ./scripts/test.sh
  ``` 